# Contributing

## Short links to important resources:
- [Moray on Azure Devops](https://mscomdev.visualstudio.com/Moray)
- [Backlog](https://mscomdev.visualstudio.com/Moray/_backlogs/backlog/Moray%20Team/Requirements) - Current project backlog.
- [Development staging site](https://moray-release.azurewebsites.net/) - Used for component staging, review and QA.
- [Latest component library](https://moray-prod.azurewebsites.net/) - The latest published version of the MWF component library.
- [Bootstrap 4 Docs](https://getbootstrap.com/docs/4.0/getting-started/introduction/) - Moray's foundation is based on Bootstrap 4. It is recommended that you familiarize yourself with Bootstrap 4, including its component libray, approach, and concepts.
  - ["The Bootstrap Approach"](https://getbootstrap.com/docs/4.0/extend/approach/) - Moray inherits these philosophies. Any contribution should adhere to these concepts and practices.
- [Notebook](https://microsoft.sharepoint.com/:o:/t/Moray/EjVWo8HlB95FiwdE89ia3LkBqXTkiYo9TZDnyQN3TFCfSQ?e=TLbhzE) - Project working notebook with additional documentation and contribution notes.


## Getting started

For **detailed** instructions on getting the project installed and running locally read the [Contributing](https://mscomdev.visualstudio.com/Moray/_wiki/wikis/Moray.wiki/28/Contributing) page in the Moray Wiki. Setup instructions can also be found in the project README.

### Node.js version

We recommend the LTS version of [Node.js](https://nodejs.org/en/) and require at least Node.js `14.17.0` and npm `7.14.0`. You can check your Node.js version by running `node -v` from the command line. If it is below `14.17.0` please download and install the latest LTS version from the Node.js website.

If you need to switch between multiple versions of Node.js on your machine, you can use a version manager like [nvm](https://github.com/nvm-sh/nvm) on Mac or [nvm-windows](https://github.com/coreybutler/nvm-windows) on Windows. We provide a [`.nvmrc` file](https://github.com/nvm-sh/nvm#nvmrc), so if you are using nvm you can simply run `nvm install` and `nvm use` to install and use the correct Node.js version.

## Creating a working branch

### Always fork from the `release` branch
All contributors should consider `release` to be the main development branch. Therefore, all new working branches are created off of `release`.

Be sure to do the following before starting work on a contribution:

```bash
$ git checkout release
$ git pull origin release
$ git checkout -b <new branch name>
```

### Branch naming conventions
Naming conventions help fellow contributors understand the scope of work and issue you are addressing in your branch. Consider the following naming convention:

```
<feature/bug/update>/<work item number>-<description>
```
1. Start with a branch folder:
    - `bug` - Used for work items filed as bugs
    - `feature` - Used for work items filed as new features
    - `update` - Used to submit updates to a work item currently in QA, and therefore does not have a separate work item associated with it.

2. Add the work item number
3. Add a short description

Together, it should look something like this:

```
feature/418-dropdown-buttons
```

## Code expectations and requirements
Be sure to review the developer [Architecture](https://microsoft.sharepoint.com/teams/Moray/_layouts/15/WopiFrame.aspx?sourcedoc={c1a35635-07e5-45de-8b07-44f3d89adcb9}&action=edit&wd=target%28Developer.one%7Cccdea166-e410-a841-a944-bdd4c2d8302c%2FArchitecture%7Ce4229690-fef4-4648-8c1d-5e803e06cf26%2F%29) guidance. This outlines code contribution expectations and requirements.

### Editor config
This project includes an [`.editorconfig`](https://editorconfig.org/) file that can automatically update your code editor's settings while working on this project. You can find [plugins for most editors here](https://editorconfig.org/#download).

### Linters
We have configured [stylelint](https://stylelint.io/) for SCSS files and [ESLint](https://eslint.org/) for JS files. To run the linters, use the command `npm run lint`. Keep in mind that builds with linting errors will fail, so please fix linting errors before creating a pull request.

To see linting errors in your code editor in real time, you may need to install an extension or plugin. For [Visual Studio Code](https://code.visualstudio.com/), we recommend these extensions:
* [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
* [stylelint](https://marketplace.visualstudio.com/items?itemName=shinnn.stylelint)

### Prettier config
A [Prettier](https://prettier.io/) configuration is also included if you use one of its editor extensions for code formatting. This **does not** enforce style rules or run on commits or builds; rather, it helps editors auto-format code to match our lint settings (above).

### Testing

#### Unit: "test the parts in isolation"
Use unit tests to cover expected output of component variants and to test function output given specified input. As a consumable library, aim for 100% coverage of public JavaScript when possible.
- **Tools**: [Jest](https://jestjs.io/) with [jsdom](https://github.com/jsdom/jsdom)
- **Command**: `npm test` (with optional `--watch` flag for development)
- Examples:
  - Component initialization
  - Component states
  - Event listeners called
  - JS functions

#### Functional: "test what it does"
Use functional tests to simulate user interactions and verify components _behave_ as expected. Cover the most critical interactions in order to ship confidently.
- **Tools**: [Cypress](https://cypress.io/)
- **Command**: `npm run cypress-open` for a local UI and watch mode for development. `npm run cypress` for a single run. Note that the dev server must be running separately for Cypress to access `localhost` URLs.
- Examples:
  - Interactive side effects (flyouts, popovers, modals)
  - Responses to events or browser/viewport changes
  - Content reflow
  - Multiple/dependent components on the same page

#### Visual regression: "test how it looks"
Use visual regression tests to ensure components are visually rendered as expected in various states.
- **Tools**: [Percy](https://percy.io/) (cloud service), integrated within Cypress
- _Integration TBD_

#### Code Coverage
Aim to maximize JavaScript code coverage when possible. Jest and Cypress code coverage reports are merged on build and checked against minimum percentage thresholds defined in `.nycrc.json`. To run both test suites together and generate the same combined report in development, run `npm run test-coverage`.

### Git hooks
The `lint` and `test` scripts will run before pushing from your local repository to the remote, and if they fail you will not be able to push. To bypass this check and force push your code, run `git push --no-verify`.

### Bundle size
We have established a budget to ensure that our CSS and JavaScript bundle sizes remain as small as possible. When opening a pull request, the build will check the bundle sizes in your PR against the sizes configured in `bundlesize.config.json`. You can check your bundle sizes locally using the command `npm run test-bundlesize`.

## Submitting work for review

### Developer QA checklist
Be sure to run through the [Developer QA checklist](https://microsoft.sharepoint.com/teams/Moray/_layouts/15/WopiFrame.aspx?sourcedoc={c1a35635-07e5-45de-8b07-44f3d89adcb9}&action=edit&wd=target%28Developer.one%7Cccdea166-e410-a841-a944-bdd4c2d8302c%2FDev%20QA%20Process%7C2ac022de-3bc4-5844-b5a0-9829a7ded84a%2F%29) prior to submitting your work for review.

### Creating a pull request
Once your work is ready for review, push your branch to Azure Devops and create a new pull request into `release`. Azure Devops pull requests can be found [here](https://mscomdev.visualstudio.com/_git/Moray/pullrequests?_a=active).

When creating your PR, be sure to attach your relevant work item (the same work item number in your branch name) and any other related bugs or tickets that may be addressed by your branch. You may set the PR to complete automatically once all requirements are met.

When completing a PR or enabling auto-complete, be sure the following options are set:

- set "Merge type" to "Squash commit"
- **uncheck** "Complete associated work items after merging"
- check "Delete <branch-name> after merging"
