The Collapse component consists of a Collapse button and some Collapse content that is expanded or collapsed when the Collapse button is pressed. When the Collapse button is pressed, it toggles the visibility of the Collapse content. It can be used on its own or combined with other instances of Collapse to form an [Accordion](https://moray-prod.azurewebsites.net/components/detail/accordion--default.html).

## Style

The Collapse component has its own style class for use with a standard instance of a [Button](https://moray-prod.azurewebsites.net/components/detail/button--default.html). When both the `btn` and `btn-collapse` classes are used together, they implement the standard style of the Collapse button.

```html
<button class="btn btn-collapse" aria-expanded="false">What is Windows?</button>
```

The Collapse button has a transparent background, no border, and an indicator chevron glyph on its left side at its start. The chevron glyph points down when the button has `aria-expanded="true"` and to the right when the button has `aria-expanded="false"`; this chevron glyph indicates the state of the Collapse button visually. When this state changes, a CSS transition animates the chevron turning. In RTL pages, the chevron glyph is on the right side of the button and points left when the button has `aria-expanded="false"`.

The expanding and collapsing of the Collapse content also has a CSS transition where the element below it appears to slide down to reveal it or slide up to conceal it. Both CSS transition animations are turned off for users who have their system or browser set to reduced motion, as detected by the `prefers-reduced-motion` media query.

### Modifier classes

The Collapse button, being a [Button](https://moray-prod.azurewebsites.net/components/detail/button--default.html) component, can be used with modifier classes from the Button component. The `btn-collapse` class that is essential for the indicator chevron, also sets the background color, so modifier classes that set background colors, like `btn-primary`, should not be used. However, these sizing modifier classes can be used:

| Class             | Description              |
| ----------------- | ------------------------ |
| `btn-sm`          | Makes the button smaller |
| `btn-lg`          | Makes the button larger  |

### Supporting components

The Collapse component uses as its key control an instance of the [Button](https://moray-prod.azurewebsites.net/components/detail/button--default.html) component. More documentation about it can be found on its own page. Within the Button, a [Glyph](https://moray-prod.azurewebsites.net/components/detail/glyphs--glyphs.html) is used as a visual indication of the state of the Collapse component.

## Behavior

When the Collapse button is pressed (by keyboard or mouse), the Collapse content is toggled. This happens in a two-step transition process:

1. The class `collapse` is replaced with the class `collapsing` on the Collapse content element. This class, alongside a height style set programmatically by the JS, implements the sliding animation. While transitioning, presses on the Collapse button are ignored
2. Once the transition is complete, the `collapsing` class is replaced by the `collapse` class and, if it was expanding, the `show` class

Expanding, step-by-step:

```html
<div class="collapse">Windows is an operating system</div> <!-- Collapsed or hidden -->
```

```html
<div class="collapsing" style="height: 40px">Windows is an operating system</div> <!-- Transitioning -->
```

```html
<div class="collapse show">Windows is an operating system</div> <!-- Expanded or shown -->
```

Note that if transitions are turned off either because of user preference or with a CSS rule, this process still happens, just with a transition time of `0` instead.

The Collapse button also undergoes important changes when it is pressed. The class `collapsed` is added or removed as appropriate, which controls which way the indicator chevron points. More crucially for accessibility, its `aria-expanded` property is updated to `true` or `false` as appropriate. For the `aria-expanded` property to work properly, the `aria-controls` property must also be set to the `id` of the Collapse content element. For example:

```html
<button class="btn btn-collapse collapsed" aria-expanded="false" aria-controls="myCollapseContent">What is Windows?</button>
<div id="myCollapseContent" class="collapse">Windows is an operating system</div>
```

### Group management

This is documented in more detail on the [Accordion](https://moray-prod.azurewebsites.net/components/detail/accordion--default.html) page, but briefly, a group of Collapse components can be coordinated if they have the same `parent` instance property. This property can be set at initialization by either a `data-parent` attribute on the Collapse content element, or passed into the constructor via JS. The `parent` is just a property, and can be any value, it just needs to be truthy (`!!myCollapse.parent === true`)) and equal (`===`) among the Collapse instances in the group; the Collapse JS will search all instances of Collapse on the page for matches every time one is toggled.

If a Collapse instance that has its `parent` property defined, when it's expanded, any other Collapse components that are expanded get collapsed.

### Collapse controls

A group of Collapse components can be expanded and collapsed all at once by making use of the CollapseControls class. This class enables a pair of buttons to expand all Collapses in a group and collapse all Collapses in a group, respectively. For example:

```html
<div data-mount="collapse-controls" data-target="#accordionExample">
  <button aria-disabled="false" aria-pressed="false" data-action="expand">Expand all</button>
  <button aria-disabled="false" aria-pressed="false" data-action="collapse">Collapse all</button>
</div>
```

In this example, the "Expand all" and "Collapse all" buttons do what they say, targeting any Collapses found during initialization within the element with the `id` `accordionExample`. The `data-target` property tells the instance which element to search for collapses with a CSS selector such a `#accordionExample`. When pressed, an expand all or collapse all button will become disabled until it is possible to take that action again. The CollapseControls instance will also manage the ARIA attributes appropriately, as well as detecting whether all of the Collapses are expanded or collapses and disabling or enabling the controls as appropriate. It detects whether the Collapses are expanded or collapsed by listening for `onShown` and `onHidden` events on each Collapse, see the [Events](#events) section below.

Note that this interaction pattern is incompatible with the group management pattern described in the preceding section.

This is documented in more detail on the [Accordion](https://moray-prod.azurewebsites.net/components/detail/accordion--collapse-controls.html) page with regards to style and accessibility concerns.

### Required `data-` attributes

While in most components, `data-` attributes serve only to pass configuration options to the auto-initialization script, for the Collapse component they also serve as necessary selectors for the JS to hook onto. The `data-mount` and `data-target` attributes are strictly required.

| Property        | Value                                  | Description                                                                              |
|-----------------|----------------------------------------|------------------------------------------------------------------------------------------|
| `data-mount`    | `collapse`                             | Hook for the auto-initialization script but also necessary for updating ARIA attributes  |
| `data-target`   | `id` of Collapse content element       | Necessary for code to find Collapse content element, and for updating ARIA attributes    |

Also, if using the CollapseControls class to enable expand/collapse all functionality, these attributes are strictly required.

| Element                         | Property        | Value                                 | Description                                                                 |
|---------------------------------|-----------------|---------------------------------------|-----------------------------------------------------------------------------|
| Base CollapseControls element   | `data-target`   | `id` of element containing Collapses  | Necessary for code to find target element                                   |
| Each CollapseControls button    | `data-action`   | `expand` \| `collapse`                | Tells the code which action to take                                         |
| Each controlled Collapse button | `data-mount`    | `collapse`                            | Necessary for the CollapseControls instance to recognize them as Collapses  |

## JavaScript Usage

### Collapse

#### Initialization

To have an instance of Collapse auto-initialized, make sure the `data-mount="collapse"` attribute is set on the Collapse button when the script is loaded: 

```html
<button class="btn btn-collapse" aria-expanded="false" data-mount="collapse">What is Windows?</button>
```

To initialize a Collapse via JavaScript, create a new instance by passing in the reference of the Collapse button using the `el` option.

```js
myCollapse = new mwf.Collapse({
  el: document.querySelector('#toggleButtonId')
});
```

##### Options

Options are passed to the constructor as an object with the following properties:

| Name                | Type        | Required  | Default | Description                                                                                           |
|---------------------|-------------|-----------|---------|-------------------------------------------------------------------------------------------------------|
| `el`                | `Node`      | yes       | `null`  | The element that toggles the Collapse                                                                 |
| `toggle`            | `Boolean`   | no        | `false` | Whether to toggle the Collapse after initialization                                                   |
| `parent`            | Any         | no        | `null`  | Any instances with the same `parent` will collapse if this instance is expanded                       |
| `addEventListener`  | `Boolean`   | no        | `true`  | If set to `false`, does not add event listener to toggle button, but other functions will still work  |

#### Events

This table summarizes custom events that can be fired by a Collapse instance. Events that don't bubble must be listened for on the event target.

| Event name | Event target    | Bubbles | Description                                                              |
| ---------- | --------------- | ------- | -------------------------------------------------------------------------|
| `onHide`   | _instance_.`el` | No      | Dispatches when the Collapse starts its slide-out animation              |
| `onHidden` | _instance_.`el` | No      | Dispatches as the Collapse finishes its slide-out animation              |
| `onShow`   | _instance_.`el` | No      | Dispatches when the Collapse starts its slide-in animation               |
| `onShown`  | _instance_.`el` | No      | Dispatches as the Collapse finishes its slide-in animation               |
| `onUpdate` | _instance_.`el` | Yes     | Dispatches when the `.update()` method is called                         |
| `onRemove` | _instance_.`el` | Yes     | Dispatches when the `.remove()` method is called                         |

**Important:** The _instance_.`el` property above is not the Collapse button marked with `data-mount="collapse"`, but instead the Collapse content element that is collapsed and expanded.

#### Static Methods

##### getInstances()

Returns a list of all instances.

| Returns | Description                                             |
|---------|---------------------------------------------------------|
| `Array` | An array of all current instantiated Collapse instances |

#### Instance methods

##### toggle()

Toggles the Collapse from show to hide and vice versa. Will fire the appropriate events.

##### show()

Shows the Collapse element. Dispatches the `onShow` event as it starts to the Collapse content element, and the `onShown` event when it finishes.

##### hide()

Hides the Collapse element. Dispatches the `onHide` event as it starts to the Collapse content element, and the `onHidden` event when it finishes.

##### update()

Placeholder method that only fires `onUpdate` event and doesn't update anything at this time.
##### remove()

Removes the event listeners and the instance.

#### Instance properties

Besides the functions and events documented above, these are the properties exposed on an instance of Collapse. These are generally intended to be read-only, altering them directly may have unpredictable side-effects

| Name                      | Type          | Description                                                                                                                 |
| ------------------------- | ------------- | --------------------------------------------------------------------------------------------------------------------------- |
| `el`                      | `Node`        | The Collapse content element that is collapsed and expanded, **not** the Collapse button passed in as the `el` option       |
| `events`                  | `Array`       | An array of objects describing the event listeners and handlers added by this instance                                      |
| `isTransitioning`         | `Boolean`     | Whether the Collapse content element is currently transitioning between shown and hidden, in either direction               |
| `isCollapsed`             | `Boolean`     | Whether the Collapse content element is currently collapsed               |
| `parent`                  | (Any)         | All Collapse instances with the same `parent` property are treated as a group; if one is expanded, all others are collapsed |
| `toggleArray`             | `Array`       | Array of all Collapse buttons that control this Collapse's content element                                                  |
| `toggleOnInit`            | `Boolean`     | Deprecated; if `true`, will toggle on initialization                                                                        |
| `triggerElement`          | `Node`        | The Collapse button, passed in as the `el` option or tagged with `data-mount="collapse"                                     |

### Collapse Controls

#### Initialization

Adding `data-mount="collapse-controls"` to the controls wrapper will auto-initialize Collapse Controls on page load.

```html
<div data-mount="collapse-controls" data-target="#accordionExample">
  (control buttons)
</div>
```

To initialize Collapse Controls via JavaScript, create a new instance by passing in the reference of the controls wrapper using the el option.

```js
myCollapseControls = new mwf.CollapseControls({
  el: document.querySelector('#controlsWrapperId')
});
```

##### Options

Options are passed to the constructor as an object with the following properties:

| Name                | Type        | Required  | Default | Description                                                       |
|---------------------|-------------|-----------|---------|-------------------------------------------------------------------|
| `el`                | `Node`      | yes       | `null`  | The element that contains the expand all and collapse all buttons |

Note that other options are set via `data-` attributes:

| Element                         | Property        | Value                                 | Description                                       |
|---------------------------------|-----------------|---------------------------------------|---------------------------------------------------|
| Base CollapseControls element   | `data-target`   | `id` of element containing Collapses  | Which element to search for Collapse instances    |
| Each CollapseControls button    | `data-action`   | `expand` \| `collapse`                | Which action to take when this button is pressed  |

#### Events

This table summarizes custom events that can be fired by a Collapse instance. Events that don't bubble must be listened for on the event target.

| Event name | Event target    | Bubbles | Description                                      |
| ---------- | --------------- | ------- | -------------------------------------------------|
| `onUpdate` | _instance_.`el` | Yes     | Dispatches when the `.update()` method is called |
| `onRemove` | _instance_.`el` | Yes     | Dispatches when the `.remove()` method is called |

#### Static Methods

##### getInstances()

Returns a list of all instances.

| Returns | Description                                                     |
|---------|-----------------------------------------------------------------|
| `Array` | An array of all current instantiated CollapseControls instances |

#### Instance methods

##### collapseAll()

Collapses all associated Collapse elements.

##### expandAll()

Expands all associated Collapse elements.

##### update()

Added for API consistency. Only fires `onUpdate` event, doesn't actually update anything at this time.

##### remove()

Removes the event listeners and the instance. Dispatches `onRemove` event.

#### Instance properties

Besides the functions and events documented above, these are the properties exposed on an instance of CollapseControls. These are generally intended to be read-only, altering them directly may have unpredictable side-effects

| Name                | Type      | Description                                                                                                             |
| ------------------- | --------- | ----------------------------------------------------------------------------------------------------------------------- |
| `accordion`         | `Node`    | The element containing the Collapse elements managed by this instance of CollapseControls                               |
| `collapse`          | `Node`    | The collapse all button                                                                                                 |
| `collapseBtnList`   | `NodeList`| An list of Collapse button elements targeted by this CollapseControls instance                                          |
| `collapseList`      | `Array`   | An array of Collapse instances targeted by this CollapseControls instance                                               |
| `collapseListCount` | `Number`  | The length of `collapseList`, or how many Collapse instances are targeted by this CollapseControls instance             |
| `el`                | `Node`    | The element containing the expand and collapse all buttons, and the `data-target` attribute indicating the `accordion`  |
| `events`            | `Array`   | An array of objects describing the event listeners and handlers added by this instance                                  |
| `expand`            | `Node`    | The expand all button                                                                                                   |
| `openCount`         | `Number`  | The number of Collapse instances targeted by this CollapseControls instance that are currently expanded                 |