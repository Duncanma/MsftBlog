{{setVar 'menuId' (evaluate menu.id '||' (uid))}}
{{setVar 'direction' (evaluate direction '||' 'down')}}
{{setProp toggle 'id' (evaluate toggle.id '||' (uid))}}
{{setProp toggle 'attributes' (evaluate toggle.attributes '||' (object))}}
{{setProp toggle.attributes 'data-mount' 'dropdown'}}
{{setProp toggle.attributes 'aria-expanded' (evaluate toggle.attributes.aria-expanded '||' 'false')}}
{{setProp toggle.attributes 'aria-controls' (getVar 'menuId')}}
{{#if toggle.classes}}
  {{#unless (contains toggle.classes 'dropdown-toggle')}}
    {{setProp toggle 'classes' (math toggle.classes '+' ' dropdown-toggle')}}
  {{/unless}}
{{else}}
  {{setProp toggle 'classes' 'dropdown-toggle'}}
{{/if}}
{{#unless toggle.link}}
  {{setProp toggle.attributes 'type' 'button'}}
{{/unless}}

<{{evaluate html-tag '||' 'div'}} class="drop{{getVar 'direction'}}{{#if toggle.split}} btn-group{{/if}} {{classes}}" {{{htmlAttr attributes}}}>
  {{#if toggle.link}}
     <a href="{{toggle.href}}" class="{{toggle.classes}}" id="{{toggle.id}}" {{{htmlAttr toggle.attributes}}}>{{toggle.text}}</a>
  {{else}}
    {{#if toggle.split}}
      {{setProp toggle.split 'style' (evaluate toggle.split.style '||' toggle.style)}}
      {{setProp toggle.split 'color' (evaluate toggle.split.color '||' toggle.color)}}
      {{setProp toggle.split 'id' (evaluate toggle.split.id '||' (uid))}}
      {{setProp toggle.split 'attributes' (object type='button') }} 
      {{#ifCond direction '===' "left"}}
        <button class="btn btn{{#if ../toggle.style}}-{{../toggle.style}}{{/if}}{{#if ../toggle.color}}-{{../toggle.color}}{{/if}} dropdown-toggle-split {{../toggle.classes}}" id="{{../toggle.id}}" {{{htmlAttr ../toggle.attributes}}}>
          <span class="sr-only">Toggle Dropdown for {{../toggle.split.text}}</span>
        </button>
        {{render '@button--default' ../toggle.split merge=true}}
      {{else}}
        {{render '@button--default' ../toggle.split merge=true}}
        <button class="btn btn{{#if ../toggle.style}}-{{../toggle.style}}{{/if}}{{#if ../toggle.color}}-{{../toggle.color}}{{/if}} dropdown-toggle-split {{../toggle.classes}}" id="{{../toggle.id}}" {{{htmlAttr ../toggle.attributes}}}>
          <span class="sr-only">Toggle Dropdown for {{../toggle.text}}</span>
        </button>
      {{/ifCond}}
    {{else}}
      {{render '@button--default' toggle merge=true}}
    {{/if}}
  {{/if}}

  <{{evaluate menu.html-tag '||' 'ul'}} class="dropdown-menu {{#if menu.right}}dropdown-menu-right{{/if}} {{#if menu.large}}dropdown-menu-lg{{/if}} {{menu.classes}}" id="{{getVar 'menuId'}}"{{#ifCond menu.html-tag '!==' 'div'}} aria-labelledby="{{#if ../toggle.split}}{{../toggle.split.id}}{{else}}{{../toggle.id}}{{/if}}"{{/ifCond}} {{{htmlAttr menu.attributes}}}>
    {{#if menu.template}}
      {{{partial menu.template.name menu.template.data}}}
    {{else}}
      {{#> menu-partial}}
        {{!-- if dropdown menu, iterate --}}
        {{#each menu.links}}
          <li>
            {{#if divider}}
              <div class="dropdown-divider"></div>
            {{/if}}
            <a class="dropdown-item" href="{{href}}">{{text}}</a>
          </li>
        {{/each}}
      {{/menu-partial}}
    {{/if}}
  </{{evaluate menu.html-tag '||' 'ul'}}>
</{{evaluate html-tag '||' 'div'}}>
