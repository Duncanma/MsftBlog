@import "../../../styles/functions";
@import "../../../variables";
@import "../../../styles/mixins";
@import "mixins";

// Range
//
// Style range inputs the same across browsers. Vendor-specific rules for pseudo
// elements cannot be mixed. As such, there are no shared styles for focus or
// active states on prefixed selectors.

.custom-range {
  width: 100%;

  .custom-range-input {
    width: 100%;
    padding: 1rem 0;
    background-color: transparent;
    appearance: none;
    color: $body-color;

    @include theme-inverse {
      color: $body-color-inverse;
    }

    &:not(:disabled) {
      cursor: $custom-range-track-cursor;
    }

    &::-moz-focus-outer {
      border: 0;
    }

    &::-webkit-slider-thumb {
      width: $custom-range-thumb-width + ($custom-range-thumb-border-width * 2); // Webkit specific
      height: $custom-range-thumb-height + ($custom-range-thumb-border-width * 2); // Webkit specific
      margin-top: $custom-range-track-height - $custom-range-thumb-height + $custom-range-thumb-border-width; // Webkit specific
      @include thumb;
    }

    &::-webkit-slider-runnable-track {
      @include track;
    }

    &::-moz-range-thumb {
      width: $custom-range-thumb-width;
      height: $custom-range-thumb-height;
      @include thumb;
    }

    &::-moz-range-track {
      @include track;
    }

    &::-ms-thumb {
      width: $custom-range-thumb-width;
      height: $custom-range-thumb-height;
      margin-top: 0; // Edge specific
      @include thumb;
    }

    // Don't include track mixin, IE/Edge styles are different
    &::-ms-track {
      width: $custom-range-track-width;
      height: $custom-range-track-height;
      color: transparent;
      background-color: transparent;
      border-color: transparent;
      border-width: ($custom-range-thumb-height * 0.5);
      box-shadow: none; // Box shadow placement differs on IE and old Edge
    }

    &::-ms-fill-lower {
      background-color: $custom-range-track-bg;
      @include border-radius($custom-range-track-border-radius);
      @include transition($custom-forms-transition);

      @include theme-inverse {
        background-color: $custom-range-track-bg-inverse;
      }
    }

    &::-ms-fill-upper {
      margin-right: 15px; // arbitrary?
      background-color: $custom-range-track-bg;
      @include border-radius($custom-range-track-border-radius);
      @include transition($custom-forms-transition);

      @include theme-inverse {
        background-color: $custom-range-track-bg-inverse;
      }
    }

    // Pseudo-elements must be split across multiple rulesets to have an effect
    &:active,
    &:focus,
    &:hover {
      &::-webkit-slider-thumb {
        @include thumb-hover;
      }

      &::-webkit-slider-runnable-track {
        @include track-hover;
      }

      &::-moz-range-thumb {
        @include thumb-hover;
      }

      &::-moz-range-track {
        @include track-hover;
      }

      &::-ms-thumb {
        @include thumb-hover;
      }

      &::-ms-fill-lower {
        @include track-hover;
      }

      &::-ms-fill-upper {
        @include track-hover;
      }
    }

    // Remove default VFI and add it back to the thumb
    &:focus {
      outline: none;

      &::-webkit-slider-thumb {
        @include vfi-text-color;
        outline-offset: 0.4rem;
      }

      &::-moz-range-thumb {
        @include vfi-text-color;
        outline-offset: 0.5rem;
      }

      &::-ms-thumb {
        @include vfi-text-color;
        outline-offset: 0.5rem;
      }
    }

    &:disabled {
      &::-webkit-slider-thumb {
        width: $custom-range-thumb-width-disabled + ($custom-range-thumb-border-width * 2); // Webkit specific
        height: $custom-range-thumb-height-disabled + ($custom-range-thumb-border-width * 2); // Webkit specific
        margin-top: $custom-range-track-height - $custom-range-thumb-height-disabled; // Webkit specific
        @include thumb-disabled;
      }

      &::-webkit-slider-runnable-track {
        @include track-disabled;
      }

      &::-moz-range-thumb {
        width: $custom-range-thumb-width-disabled;
        height: $custom-range-thumb-height-disabled;
        @include thumb-disabled;
      }

      &::-moz-range-track {
        @include track-disabled;
      }

      &::-ms-thumb {
        width: $custom-range-thumb-width-disabled;
        height: $custom-range-thumb-height-disabled;
        @include thumb-disabled;
      }

      &::-ms-fill-lower {
        @include track-disabled;
      }

      &::-ms-fill-upper {
        @include track-disabled;
      }
    }

    // High Contrast Mode
    // Use native browser styles
    @media screen and (-ms-high-contrast: active) {
      appearance: auto;

      // In Chromium Edge also need to unset Shadow DOM styles
      &::-webkit-slider-runnable-track {
        background-color: unset;
      }

      &:active,
      &:focus,
      &:hover,
      &:disabled {
        &::-webkit-slider-runnable-track {
          background-color: unset;

          @include theme-inverse {
            background-color: unset;
          }
        }
      }

      // Add back default VFI
      &:focus {
        @include vfi-text-color;

        &::-webkit-slider-thumb {
          outline: none;
        }
      }
    }
  }

  .custom-range-tooltip {
    position: relative;
    height: 1.5rem;

    span {
      position: absolute;
    }
  }

  .custom-range-track-labels {
    display: flex;
    justify-content: space-between;
    margin-top: $custom-range-track-height - $custom-range-thumb-height;
  }

  &.disabled {
    .custom-range-tooltip,
    .custom-range-track-labels {
      color: $gray-500;
    }
  }
}
