A Carousel is a slideshow component that allows the user to cycle through a set of elements by interacting with Carousel controls.

**Note:** The Carousel presented here is meant to explain the markup and functionality of a generic carousel but **should not be used as is**. The following carousels are approved for use:

- [Banner Carousel](https://mwf.azurewebsites.net/catalog/carousel-banner/index.html)
- [Content Cards Sneak Peek Carousel](https://mwf.azurewebsites.net/catalog/content-cards-sneak-peek/index.html)
- [Feature Carousel](https://mwf.azurewebsites.net/catalog/carousel-feature/index.html)
- [Highlight Carousel](https://mwf.azurewebsites.net/catalog/carousel-highlight/index.html)
- [Highlight Sneak Peek Carousel](https://mwf.azurewebsites.net/catalog/highlight-sneak-peek/index.html)
- [Product Card Carousel](https://mwf.azurewebsites.net/catalog/carousel-product-card/index.html)

## Style

### Modifier classes

| Class                       | Description                                                                                                                                                |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `carousel-highlight`        | Sets Carousel indicators and flippers to always appear below slide content; when class is not present, flippers will overlap the side of the slide content |
| `carousel-lg-side-controls` | Adds additional spacing to the side of each slide; when using this class, `carousel-highlight` should not be used                                          |
| `carousel-variable-height`  | Sets the height of all slides to the height of the tallest slide                                                                                           |
| `carousel-product-card`     | Enables Product Card Carousel styles and functionality                                                                                                     |
| `carousel-sneak-peek`       | Enables Sneak Peek Carousel styles and functionality                                                                                                       |
| `slide`                     | Enables slide animation when changing slides                                                                                                               |

## Behavior

All carousel content should be included inside of a `<section>` element with `aria-label` and `aria-roledescription` properties. The `aria-label` should have text describing the purpose of the carousel. The `aria-roledescription` property must have a value of `slideshow` and **must be localized**.

Following the `<section>` element must be an `<a>` element with a `class` of `sr-only` and text declaring the end of the slideshow section.

```html
<section aria-label="Placeholder for explicit slideshow label" aria-roledescription="slideshow">...</section>

<a id="mwf0757ebbb" class="sr-only" tabindex="-1">
  End of placeholder for explicit slideshow label section
</a>
```

### Status message

To make the Carousel more accessible to those using screen readers, it should have a status message that updates and announces itself via the `aria-live="polite"` mechanism whenever the user moves the Carousel to the next or previous slide.

The JavaScript class CarouselControls will automatically update the status messages. During initialization, it will read in the text content of the messages as a template, which it will interpolate when the user advances the Carousel. For example, "Slide %{slideNumber} of %{total}. %{slideTitle}" is stored as a template, where the keys bracketed by `%{}` are replaced with the appropriate values. The following variables are available for template interpolation:

| Variable      | Description                                             |
| ------------- | ------------------------------------------------------- |
| `slideNumber` | The currently shown slide's number, starting from 1     |
| `total`       | The total number of slides or slide items               |
| `slideTitle`  | Title of the current slide                              |
| `start`       | The number of the first slide or slide item shown       |
| `end`         | The number of the last slide or slide item shown        |
| `separator`   | '-' if multiple slide items are displayed, '' otherwise |

The status message elements themselves can be arranged with a screen reader message only, or with a visible message that is also announced to screen readers.

**Note:** In every case, updates are announced to screen reader users. Also note that these status messages should not be used if the Carousel has been customized to autoplay or automatically advance to the next slide without user input.

Here is an example of distinct visible and screen reader messages, adapted from a [Product Card Carousel](https://mwf.azurewebsites.net/catalog/carousel-product-card/index.html) example:

```html
<!-- Status Message Container -->
<div id="{status-container-id}" >
  <!-- Screen Reader Status -->
  <span id="status-msg" class="sr-only" aria-live="polite">
    Showing %{start} through %{end} of %{total} items
  </span>
  <!-- Visible Status -->
  <span aria-hidden="true">Showing %{start}%{separator}%{end} of %{total} items</span>
</div>
```

In this example, the following properties are required:

| Element              | Property      | Value                 | Description             |
|----------------------|---------------|-----------------------|-------------------------|
| Status Message Container  | `id`          | unique string value | ID of node that must match `data-status` value from element with `carousel` class |
| SR Status            | `class`       | `sr-only`             | Hides element visually  |
| SR Status            | `aria-live`   | `polite`              | Tells screen readers to announce any updates to the text of this element. `polite` specifies that it shouldn't interrupt other narration |
| Visible Status       | `aria-hidden` | `true`                | Tells screen readers not to read this, as it would be redundant and/or confusing |

Product Card Carousels must also add an ID to the SR Status element and use the ID as the value of the `aria-labelledby` attribute on each slide as [described below](#slides).

The status container may have its visible status omitted:

```html
<!-- Status Message Container -->
<div id="{status-container-id}" >
  <!-- Screen Reader Status -->
  <span class="sr-only" aria-live="polite">Showing %{start} through %{end} of %{total} items</span>
</div>
```

When the visible and screen reader status text is the same, the same markup for screen reader status should be used, with the `sr-only` class removed:

```html
<!-- Status Message Container -->
<div id="{status-container-id}" >
  <!-- Combined Visible and Screen Reader Status -->
  <span aria-live="polite">Showing %{start} through %{end} of %{total} items</span>
</div>
```

### Carousel

The Carousel applies `Carousel` styles and contains [Skip Link](#skip-link), [Controls and Indicators](#controls-and-indicators), [Slides](#slides), and an optional [Back to Controls Button](#back-to-controls-button). See [Modifier Classes](#modifier-classes) for additional classes that can be used on this element.

```html
<div class="carousel">...</div>
```

### Skip link

The skip link is a `.sr-only-focusable` anchor element that allows screen reader users to skip carousel content. The skip link should be the first direct child of the Carousel element. The `href` value should be an anchor to the ID of the skip link target as shown below:

```html
<section aria-label="Placeholder for explicit slideshow label" aria-roledescription="slideshow">
  <div
    class="carousel slide carousel-highlight carousel-variable-height"
    data-mount="carousel"
    data-status="status-container">
    <!-- skip link -->
    <a href="#mwf3aa54316" class="btn btn-link sr-only-focusable w-100 position-absolute">
      Skip placeholder for explicit slideshow label
    </a>
    ...
  </div>
</section>

<!-- skip link target -->
<a id="mwf3aa54316" class="sr-only" tabindex="-1">
  End of placeholder for explicit slideshow label section
</a>
```

### Controls and indicators

The controls and indicators must be contained inside a `<div>` element with `class="carousel-controls"`.

```html
<div class="carousel-controls">...</div>
```

The Carousel controls are broken into a "previous" and "next" control. The "previous" control will present the previous slide when clicked, and the "next" control will present the next slide when clicked. If there is no previous or next slide, the controls will have an applied opacity to indicate that pressing them will not change the current slide. In the event the Carousel is circular, pressing "previous" when on the first slide will present the last slide, and pressing "next" on the last slide will present the first slide.

Both Carousel controls must be `<button>` elements with `type="button"` and `class="carousel-control-{next/prev}"`. These attributes are needed to apply the correct events to each control. In addition, there must be a `<span class="sr-only">` tag inside the buttons with text "{Previous/Next slide}". This element will enable narration of the controls to screen readers.

**Note:** The `.sr-only` text inside the `<button>` is required for accessibility and **must be localized** but should not be customized due to the risk of breaking accessibility features.

```html
<button type="button" class="carousel-control-prev">
  <span class="sr-only">Previous slide</span>
</button>
```

```html
<button type="button" class="carousel-control-next">
  <span class="sr-only">Next slide</span>
</button>
```

The indicators provide users with a visual representation of which slide is currently being presented, as well as how many slides are in the Carousel. For screen reader users, this information is conveyed by the above `status-container` element. The indicators must be an `<ol>` with `class="carousel-indicators"` and `aria-hidden="true"` attributes. The number of `<li>` tags must correspond with the number of slides in the Carousel. The `class="carousel-indicators"` attribute is used in the JavaScript to manage which indicator should be `active`. The `<li>` with a class of `active` will have its indicator displayed as a filled-in circle (indicators that are not active will be displayed as a circle with an outline). Whenever the active slide changes, the Carousel ensures only the indicator associated with the active slide has the class `active`.

**Note:** Indicators are optional and are not used in certain Carousel implementations.

```html
<ol class="carousel-indicators" aria-hidden="true">
  <li class="active"></li>
  <li></li>
  <li></li>
</ol>
```

### Slides

Carousel slides must be `<section>` elements with a class of `carousel-item`. The `carousel-item` class is referenced by JavaScript events for managing which slide and indicator should be active. The currently presented slide has the class of `active`. The Carousel functionality will break if more than one slide has a class of `active`. The `active` slide will also have a `tabindex="0"` attribute to allow focusing to the overall slide element. All slides must be contained inside a `<div class="carousel-inner">` element.

In addition, each `<section>` element must contain a programmatic `aria-label` OR the `aria-labelledby` attribute, and the `aria-roledescription="slide"` attribute. Most Carousels should use the `aria-label` attribute (except Product Carousel), which is calculated by the slide number out of the total number of slides and can be appended with an optional authorable descriptive message. Alternatively, Product Card Carousel should use the `aria-labelledby` attribute, with the value set to the ID of the [SR Status element](#status-message).

**Note:** All `aria-label` and `aria-roledescription` attributes **must be localized**. Content authors must not be expected to provide each the current slide number or total slide count. The system generating the slide HTML must accept a localized string with placeholders and generate the strings based on the number of slides. Content authors should add a descriptive message about each slide to accompany the slide number and total slide count.

#### Example using aria-label

```html
<div class="carousel-inner">
  <section class="carousel-item active" tabindex="0" aria-label="1 of {total} + (optional) Placeholder for explicit label" aria-roledescription="slide">
    {slide 1 content}
  </section>
  <section class="carousel-item" aria-hidden="true" aria-label="2 of {total} + (optional) Placeholder for explicit label" aria-roledescription="slide">
    {slide 2 content}
  </section>
  ...
</div>
```

#### Example using aria-labelledby

```html
<div class="carousel-inner">
  <section class="carousel-item active" tabindex="0" aria-labelledby="{ID of SR Status element}" aria-roledescription="slide">
    {slide 1 content}
  </section>
  <section class="carousel-item" aria-hidden="true" aria-labelledby="{ID of SR Status element}" aria-roledescription="slide">
    {slide 2 content}
  </section>
  ...
</div>
```

### Back to Controls Button

The "back to controls" button is a [link-styled Button](https://mwf.azurewebsites.net/catalog/button/index.html#link) used as an **accessibility** feature to quickly return a user's focus back to the slide controls. When clicked, the "back to controls" button will set focus to the "previous" control (if enabled) or the "next" control.

**Notes:**

- The "back to controls" button is optional and currently only used in [Product Card Carousel](https://mwf.azurewebsites.net/catalog/carousel-product-card/index.html).
- The button's text must be localized.

```html
<button class="btn btn-link back-to-controls text-left sr-only-focusable w-100 position-absolute bottom-2">
  Back to Next and Previous controls
</button>
```

The following classes are required for behavior; other CSS utilities can be used for contextual styling.

| Class               | Description                                                                                                                                                                             |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `back-to-controls`  | Selector used by JavaScript to perform focus logic.                                                                                                                                     |
| `sr-focusable-only` | Shows the element only when it receives focus. [Screen reader utility docs](https://moray-prod.azurewebsites.net/components/detail/utilities-screenreaders--sr-only-focusable-btn.html) |

## JavaScript usage

### Carousel

#### Initialization

Adding `data-mount="carousel"` to the Carousel container will auto-initialize the Carousel on page load.

| Element  | Attribute   | Value                  | Instance member            | Required | Description                                                                                                      |
| -------- | ----------- | ---------------------- | -------------------------- | -------- | ---------------------------------------------------------------------------------------------------------------- |
| carousel | data-mount  | `"carousel"`           | `el`                       | yes\*    | Initializes carousel                                                                                             |
| carousel | data-loop   | `"false"`              | `controls.loopSlides`      | no       | Prevents the carousel from looping                                                                               |
| carousel | data-status | ID of status container | `controls.statusContainer` | no       | ID of node that contains the status message templates; should not be used if the Carousel automatically advances |

\* **Attribute is required if using the auto-initialization method only. `data-` attributes are not recommended for use otherwise and may result in unexpected behavior.**

To initialize a Carousel via JavaScript, create a new instance by passing in the reference to the Carousel container element using the `el` option.

```js
myCarousel = new mwf.Carousel({
  el: document.querySelector('.carousel')
});
```

#### Options

| Name                | Type          | Required | Default | Description                                                                                                |
| ------------------- | ------------- | -------- | ------- | ---------------------------------------------------------------------------------------------------------- |
| `el`                | `HTMLElement` | yes      | `null`  | The Carousel container element                                                                             |
| `initialSlideIndex` | `Number`      | no       | `null`  | The 0-based index of the initial slide                                                                     |
| `loopSlides`        | `Boolean`     | no       | `true`  | Whether the Carousel should loop                                                                           |
| `nextOnClick`       | `Function`    | no       | `null`  | Function to override the "next" button click handler                                                       |
| `prevOnClick`       | `Function`    | no       | `null`  | Function to override the "previous" button click handler                                                   |
| `statusContainer`   | `HTMLElement` | no       | `null`  | Node that contains the status message templates; should not be used if the Carousel automatically advances |

#### Events

Events for Carousels are defined through their [CarouselControls](#carouselcontrols) instance.

#### Static Methods

##### getInstances()

Returns a list of all Carousel instances.

| Returns | Description                                    |
| ------- | ---------------------------------------------- |
| `Array` | An array of all current instantiated Carousels |

#### Instance methods

##### remove()

Removes all event listeners, observers, and references to the Carousel instance.

#### Instance properties

| Name       | Type          | Description                                                                            |
| ---------- | ------------- | -------------------------------------------------------------------------------------- |
| `controls` | `Object`      | The instance of [CarouselControls](#carouselcontrols) class that controls the Carousel |
| `el`       | `HTMLElement` | The base element of the instance, and the outermost wrapper                            |

### CarouselControls

#### Initialization

It is unnecessary to initialize a CarouselControls instance because CarouselControls are initialized in the parent [Carousel](#carousel) instance.

#### Options

| Name     | Type       | Required | Default | Description    |
| -------- | ---------- | -------- | ------- | -------------- |
| `slides` | `NodeList` | yes      | `null`  | List of slides |

**Note:** All options listed in [Carousel](#carousel) will be passed to the CarouselControls constructor as well.

#### Events

| Event name | Event target    | Description                           |
| ---------- | --------------- | ------------------------------------- |
| `onChange` | _instance_.`el` | Dispatches when a slide is changed    |
| `onUpdate` | _instance_.`el` | Dispatches when a Carousel is updated |
| `onRemove` | _instance_.`el` | Dispatches when a Carousel is removed |

#### Instance methods

Since there is no `getInstances()` static method for CarouselControls, CarouselControls must be interfaced through their corresponding [Carousel](#carousel) (e.g. `mwf.Carousel.getInstances()[{index of carousel instance}].controls.goToNextSlide()`).

##### update()

Updates the Carousel controls instance.

##### remove()

Removes all event listeners, observers, and references to the CarouselControls instance.

##### goToNextSlide()

Advances the Carousel to the next slide.

##### goToPrevSlide()

Returns the Carousel to the previous slide.

##### goToSlide()

Changes the Carousel to a specific slide.

| Params | Type     | Default | Description                             |
| ------ | -------- | ------- | --------------------------------------- |
| `num`  | `Number` | `null`  | 0-based index of the slide to change to |

#### Instance properties

| Name                | Type          | Description                                                                           |
| ------------------- | ------------- | ------------------------------------------------------------------------------------- |
| `currentSlideIndex` | `Number`      | Index of the current slide                                                            |
| `didSlide`          | `Boolean`     | Whether the Carousel has changed slides                                               |
| `el`                | `HTMLElement` | The base element of the instance, and the outermost wrapper                           |
| `indicators`        | `HTMLElement` | The indicators element                                                                |
| `isSliding`         | `Boolean`     | Whether the Carousel is currently sliding                                             |
| `itemImg`           | `NodeList`    | List of background images for slides; size should be equal to size of slides NodeList |
| `loopSlides`        | `Boolean`     | Whether the Carousel is circular                                                      |
| `nextBtn`           | `Node`        | The next control element                                                              |
| `prevBtn`           | `Node`        | The previous control element                                                          |
| `slides`            | `NodeList`    | List of slides                                                                        |
| `statusContainer`   | `Node`        | Status container for screen readers                                                   |
| `touchUtil`         | `TouchUtil`   | Instance of TouchUtil class; used for navigation by touch                             |
