The user selects color values using radio buttons in a `<fieldset>`, which changes an image to correspond to the selected color. It can be used to provide users with a comparison tool for color options.

```html
<img src="https://via.placeholder.com/300/664041/" id="my-image-id" alt="" />
...
<fieldset data-controls="my-image-id">
  {color-picker-controls} <!-- Any number of Color Picker controls, see below -->
</fieldset>
```

Color Picker behavior is implemented by the ColorPicker and ColorPickerControl classes.

## Style

The Color Picker can target any image, and does not impose any styles on the targeted image. However, the style of Color Picker controls (the swatches or dots) themselves are strictly defined, and only the color may be configured.

There are a few name-spaced classes used to set styles for this component and they are not configurable but are included for reference. They are, however, required to implement the intended visual user experience.

| Class                   | Description       |
|-------------------------|-------------------|
| `color-picker`          | Organizes some conditional styles and responsiveness |
| `color-picker-control`  | Hides the default radio button in favor of the SVG circle |
| `color-picker-dot`      | Implements border, background, and hover styles for the control |
| `color-picker-label`    | Positions the visible text |

### Dot color

Each Color Picker control is a colored dot that can be selected by a user. The markup of each control (the `<input>`, `<label>`, `<svg>`, and `<span>`s, collectively) should match the sample code except for the color and the text that identifies the color. The color itself is set by modifying the hex code of the SVG fill and the `<span>`'s `background-color` style. Below is an example of an individual Color Picker control, consisting of a radio `<input>` and a linked `<label>`. Inside the `<label>` is an SVG circle of the color and a text `<span>` describing the color.

```html
<input
  class="color-picker-control" name="color-picker-control" id="color-burgundy" type="radio" data-color-picker-image="https://via.placeholder.com/300/664041/"
  aria-label="burgundy"
/>
<label for="color-burgundy" aria-hidden="true" title="burgundy">
  <span class="color-picker-dot" style="background-color: #664041">
    <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="#664041" /></svg>
  </span>
  <span class="color-picker-label">burgundy</span>
</label>
```

To customize the color of a Color Picker control, update the following properties:

| Element     | Property        | Value             | Description     |
|-------------|-----------------|-------------------|-----------------|
| `input`     | `aria-label`    | Name of the color | Read by screen readers |
| `label`     | `title`         | Name of the color | Appears as a tooltip on mouse hover |
| `label`     | `aria-hidden`   | `true`            | Prevents the screen reader from trying to read the SVG |
| `.color-picker-dot` | `style.background-color` | RGB hex value of the color (e.g. `style="background-color: #664041"`) | The `background-color` must be set explicitly on _this_ element _before_ initialization (the recommended way to do so is via an inline-style as shown in the example) |
| `svg > circle` | `fill`       | RGB hex value of the color | Sets the visual color of the SVG circle |
| `color-picker-label` | text   | Name of the color | Appears visually when this Color Picker control is selected |

## Behavior

The basic function of the Color Picker is to sync a single image's `src` with a set of [radio inputs](https://mwf.azurewebsites.net/catalog/radio-group/index.html). The ColorPicker class monitors a particular `<fieldset>` of radio `<input>`s, and when one of these `<input>`s is selected, it updates the `src` attribute of the image to the URL specified in the `data-color-picker-image` of the `<input>`.

The image and fieldset don't necessarily need to be near each other in the DOM, but keep in mind that updates to the image will not be communicated via screen readers, so the image should be decorative, and the fieldset should control more than just the image. For example, based on the color selected in the fieldset, a subsequent "Add to cart" button will add a product of the selected color.

A `<legend>` element should always be included for accessibility, but it may be visually hidden with an `sr-only` class.

```html
<img src="https://via.placeholder.com/300/664041/" id="my-image-id" alt="" />
```

```html
<fieldset data-controls="my-image-id">
  <legend>Choose your color:</legend>
  <input name="color-picker-control" id="color-burgundy" type="radio" data-color-picker-image="https://via.placeholder.com/300/664041/" />
  <label for="color-burgundy">
    {color-picker-controls} <!-- SVG and text content, see above -->
  </label>
  {additional-radio-inputs}
</fieldset>
```

The following properties are required for the JavaScript to function properly:

| Element     | Property        | Value                   | Description     |
|-------------|-----------------|-------------------------|-----------------|
| `<img>`     | `id`            | A unique identifier     | Allows the JS to target the image |
| `<img>`     | `alt`           | Empty string            | Indicates that the image is decorative (adds no substantive information that a screen reader needs to narrate) |
| `<fieldset>`| `data-controls` | The `id` of the `<img>` | Tell the JS which image to target for updates (see note below on updating this) |

### Controls

The structure of each Color Picker control needs to be organized as follows:

```html
<input
  name="color-picker-control"
  id="color-burgundy"
  type="radio"
  data-color-picker-image="https://via.placeholder.com/300/664041/"
  checked
/>
<label for="color-burgundy">
  {color-picker-controls} <!-- SVG and text content, see above -->
</label>
```

The following properties are required for the JavaScript to function properly:

| Element     | Property        | Value             | Description     |
|-------------|-----------------|-------------------|-----------------|
| `<input>`   | `name`          | An identifier shared by every `<input>` in this Color Picker but not repeated anywhere else on the page | Tells browser to coordinate the radio buttons to ensure only one color is selected at a time |
| `<input>`   | `id`            | A unique identifier       | Allows the `<label>` to target it |
| `<input>`   | `type`          | `radio`           | Tells browser to treat it as a radio button |
| `<input>`   | `data-color-picker-image` | The URL of an image | Tells the JS what to update the `src` of the image to when this control is selected |
| `<input>`   | `checked`       | Present or not    | Should be present on the Color Picker control that is selected by default |
| `<label>`   | `for`           | The `id` of the `<input>` | Tells screen readers and the JS which `<input>` it is connected to |

### Targeted image

The Color Picker component changes an image by updating its `src` attribute, but it does not impose any restrictions on the look and feel of the image.

>**Note:** The Color Picker can only change the `src` attribute of one element, so the image should be a single `<img>` element with a `src` attribute; it should not be used with a `<picture>` element that makes use of a `srcset`.

>**Note:** The image's `alt` text is _not_ updated by the Color Picker, so every image should be decorative (redundant of the text in the controls; use `alt=""`), or the `alt` text should apply equally to every version of the image.

>**Deprecation:** The Color Picker originally could alter the background image of a generic element, but since background images are not visible in Windows' High Contrast Mode, this creates an accessibility issue. For this reason, background image switching is deprecated and will be removed in a future version.

### Legend

This element is required and its text should concisely describe the purpose of the fieldset (along the lines of "Choose your color"). As long as it's visually clear what the Color Picker does in the context of the page, the legend may be hidden visually while still being made available to the screen reader by giving it the `sr-only` class, like so:

```html
<legend class="sr-only">Choose your color</legend>
```

Full documentation of `sr-only` can be found [here](https://moray-prod.azurewebsites.net/components/detail/utilities-screenreaders--sr-only.html).

### Keyboard interactions

The keyboard interactions with the Color Picker controls are the same as with any group of radio inputs (e.g., tabbing to the controls will place focus on the selected Color Picker control, and arrow keys can be used to select and focus a different control in the group). "Up" and "left" arrow keys select the previous Color Picker control, while "down" and "right" keys select the next Color Picker control. This is implemented by the browser, and no special properties are required, other than the `name` property of each `<input>` element being the same.

## JavaScript usage

### ColorPicker class

The main Color Picker functionality is implemented by the ColorPicker class. Using the default setup, it will be available at `window.mwf.ColorPicker`.

#### Initialization

Adding the `data-mount="color-picker"` to the `<fieldset>` element will cause the auto-initialization script to create and initialize an instance of the ColorPicker class for that element.

To initialize manually via JavaScript, the `<fieldset>`'s DOM node must be passed to the constructor as the `el` property of the options object parameter. For example:

```js
const myColorPicker = new window.mwf.ColorPicker({
  el: document.querySelector('fieldset#myColorPickerFieldset')
});
```

For the ColorPicker class, options may be passed to the constructor as an object with the following properties:

| Name      | Type        | Required | Default | Description |
|-----------|-------------|----------|---------|-------------|
| `opts`    | `Object`    | yes      | `{}`    | An object containing configuration options |
| `opts.el` | `Node`      | yes      | `null`  | The `<fieldset>` element |

#### Events

The ColorPicker class does not fire any custom events, but the [ColorPickerControl class](#ColorPickerControl-class) does (see below).

#### Static methods

These functions can be found on the class itself. By default, it can be found at `window.mwf.ColorPicker`.

##### getInstances()

Returns a list of all instances of ColorPicker.

| Returns | Description |
|---------|-------------|
| Array   | An array of all current instances. Note that deleting the associated DOM nodes will not remove an instance of ColorPicker. `remove()` must be called explicitly. |

#### Instance methods

These are functions that can be called from an instance of ColorPicker.

##### remove()

Removes all event listeners, observers, and references to the instance, and will also tear down any instances of ColorPickerControl related to it (see below).

##### update()

Re-initializes the instance, optionally based on a different base DOM Node. Useful when the relevant elements of the DOM have been altered or re-rendered.

The following options may be passed to the function as properties of an options object:

| Name      | Type        | Required | Default | Description |
|-----------|-------------|----------|---------|-------------|
| `opts`    | `Object`    | no       | `{}`    | An object containing configuration options |
| `opts.el` | `Node`      | no       | `null`  | The `<fieldset>` element |

For example:

```js
myColorPickerInstance.update({ el: myNewFieldsetNode });
```

If `el` is not specified, the instance will initialize using its current base Node stored in `this.el`.

#### Instance properties

This table summarizes the members of the ColorPicker class:

| Name              | Type    | Description             |
|-------------------|---------|-------------------------|
| _instance_.`containerTarget` | `Node`    | The `<img>` whose `src` is update by the ColorPicker |
| _instance_.`controls`        | `Array`   | An array of ColorPickerControl instances, one for each Color Picker control (`<input>` and its `<label>` in the base `<fieldset>`) |
| _instance_.`el`              | `Node`    | The base DOM Node, a `<fieldset>` |

### ColorPickerControl class

The ColorPickerControl class encapsulates some functionality of the Color Picker and is not intended to be used on its own. By default, it will not be available outside the scope of the ColorPicker class and will **not** be found at `window.mwf.ColorPickerControl` or similar. The following documentation is included for debugging purposes.

Each instance of ColorPickerControl corresponds to one color control (`<input>` and `<label>` together). When initialized, it calculates and sets an accessible background color on the control, and then adds an event listener that updates the targeted image when the control is activated.

#### Initialization

ColorPickerControl instances are managed by the ColorPicker class directly and are not meant to be initialized directly. To add or remove a single ColorPickerControl, call `.update()` on the relevant ColorPicker instance instead.

#### Events

This table summarizes custom events that can be fired by a ColorPickerControl instance. Events that don't bubble must be listened for on the event target.

| Event name  | Event target  | Bubbles | Description |
|-------------|---------------|---------|-------------|
| `onChange`  | _instance_.`containerTarget`   | No      | Fires whenever the `src` of the `<img>` is updated by the Color Picker |
| `onRemove`  | _instance_.`el` | Yes     | Fires whenever an instance of ColorPickerControl is removed via its `remove()` function |

#### Static methods

These should only be used within the ColorPicker class (e.g., when tearing down the component).

##### getInstances()

Returns a list of all instances of ColorPicker.

| Returns | Description |
|---------|-------------|
| `Array` | An array of all current instances. Note that deleting the associated DOM nodes will not remove an instance of ColorPickerControl. `remove()` must be called explicitly |

#### Instance methods

These should only be used within the ColorPicker class (e.g., when tearing down the component).

##### remove()

Removes all event listeners, observers, and references to the instance, and then dispatches the custom event `onRemove` to the `<input>` element.

#### Instance properties

This table summarizes the members of the ColorPickerControl class. They should only be accessed from within the ColorPicker class.

| Name              | Type    | Description             |
|-------------------|---------|-------------------------|
| _instance_.`containerTarget` | `Node`    | The `<img>` whose `src` is updated when this Color Picker control is activated |
| _instance_.`el`              | `Node`    | The base `<input>` element of this ColorPickerControl instance |
| _instance_.`events`          | `Array`   | An array of objects representing event listeners that are added to the DOM by this instance. There should be only one, which will for a `change` event on the `<input>` and updating the `<img>` in the handler |
