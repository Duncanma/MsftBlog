The Positioner class can help manage the position of absolutely or relatively positioned elements. It enables setting an inline position per viewport size.

## Responsiveness

It may be desirable to position an element differently depending on the size of the viewport. In cases where this viewport-based positioning is known ahead of time and is not dynamic (e.g. changing based on user input), it is strongly recommended to use a stylesheet or `<style>` tag instead of the Positioner class (documented in the [Behavior](#behavior) section below). For example:

```css
#my-absolutely-positioned-element-1 {
  top: 55%;
  left: 40%;
}

@media screen and (min-width: 860px) {
  #my-absolutely-positioned-element-1 {
    top: 70%;
    left: 60%;
  }
}
```

Using only CSS like this will always have a better performance and tax the user's device less than using the Positioner class to achieve the same result. The Positioner class is intended for scenarios where the position of the hotspot will need to change dynamically.

## Style

The only styles set by the Positioner class are `top` and `left`, and does not set an element to `position: relative` or `position: absolute` itself. 

Also, note that the Positioner will not account for right-to-left or `rtl` pages, so positioning a relatively positioned element may not work as intended in those pages.

## Behavior

As discussed above, if possible, a CSS-only approach is best. If the position of a Hotspot may need to be updated dynamically, but would never need to change based on the viewport, the standard browser APIs would be the best choice, for example:

```js
function setPosition(node, xPos, yPos, unit) {
  node.style.left = xPos + unit;
  node.style.top = yPos + unit;
  return node;
}
```

This helper function is conveniently available as a static method at `Positioner.setPosition`, but note that since it alters inline styles, position set this way will generally take precedence over the stylesheet. Inline position styles can be cleared with the static method `Positioner.clearInlinePosition`.

However, in cases where the position of a Hotspot is dynamic _and_ may need to change based on the viewport, the Positioner class is a good option. It provides an API to define and dynamically redefine the position of a Hotspot based on the standard MWF breakpoints of `540px`, `860px`, `1084px`, and `1400px` (see the [Grid](https://moray-prod.azurewebsites.net/components/detail/grid.html) documentation page for more detail on breakpoints). It achieves this by making use of the event-driven `MediaQueryList` interface with a call to `window.matchMedia()` when it is initialized.

When using the Positioner class, keep in mind that it positions by percent, not by pixels (decimal such a `22.5%` are ok). Also note that while some components, such as [Hotspots](https://moray-prod.azurewebsites.net/components/detail/hotspot.html), have been specially styled so that the Positioner will position them based on their center point, if the Positioner is used with a different element, the upper left corner will be used as a reference. Also, the element must already have the style `position: absolute` or `position: relative` for the Positioner to work. Finally, note that the styles defined at the breakpoints are defined for that viewport width _up_, that is, using the `md` break point as an example, the media query used is:

```css
@media screen and (min-width: 860px) {}
```

## JavaScript usage

This section describes the details of using the Positioner class, which allows for defining the position of an element.

### Initialization

An instance of Positioner is tied to a specific element. Instances can be initialized via the MWF auto-initialization script at page load by marking the element with the `data-position="positioner"` attribute. Note that this is a bit different than the typical `data-mount` attributes used in other components because this base element may be shared by another component, such as Popover.

Initialization options may also be defined for the auto-initialization script via `data-` attributes, for example:

```html
<button data-position="positioner"
  data-position-top-default="15.2"
  data-position-left-default="15.2"
  data-position-top-md="25.2"
  data-position-left-md="25.2"
>
  Press me!
</button>
```

This is a full table of initialization options that can be passed via `data-` attributes:

| Attribute                       | Value             | Required          | Description                                                                   |
|---------------------------------|-------------------|-------------------|-------------------------------------------------------------------------------|
| `data-position`                 | `"positioner"`    | Yes*              | Marks this element for the auto-initialization script                         |
| `data-position-top-default`     | `Int` or `Float`  | Recommended**     | Sets the default `top` style property in `%` units                            |
| `data-position-left-default`    | `Int` or `Float`  | Recommended**     | Sets the default `left` style property in `%` units                           |
| `data-position-top-sm`          | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `540px` and wider    |
| `data-position-left-sm`         | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `540px` and wider   |
| `data-position-top-md`          | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `860px` and wider    |
| `data-position-left-md`         | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `860px` and wider   |
| `data-position-top-lg`          | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1084px` and wider   |
| `data-position-left-lg`         | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1084px` and wider  |
| `data-position-top-xl`          | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1400px` and wider   |
| `data-position-left-xl`         | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1400px` and wider  |

\* Only required when using the auto-initialization. When passing options to the constructor vis JS, using `data-` attributes is not recommended.

\*\* This is the fallback style. If one isn't defined, the Positioner instance will instead remove inline position styles (`top`, `left`, `right`, and `bottom`).

Instances of the Positioner class can also be initialized vis JS by passing an options object to its constructor, as in the following example:

```js
myPositioner = new mwf.Positioner({
  el: document.querySelector('#positionerId'),
  positionMap: {
    default: {
      top: 15.2,
      left: 15.2
    },
    md: {
      top: 25.2,
      left: 25.2
    }
  }
});
```

Note that while options passed in via the `data-` attributes had a flat structure, the options object passed in via JS is more structured. The full list of options is summarized in this table:

| Option                          | Value             | Required          | Description                                                                   |
|---------------------------------|-------------------|-------------------|-------------------------------------------------------------------------------|
| `opts.el`                       | `"positioner"`    | Yes               | Marks this element for the auto-initialization script                         |
| `opts.positionMap.default.top`  | `Int` or `Float`  | Recommended*      | Sets the default `top` style property in `%` units                            |
| `opts.positionMap.default.left` | `Int` or `Float`  | Recommended*      | Sets the default `left` style property in `%` units                           |
| `opts.positionMap.sm.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `540px` and wider    |
| `opts.positionMap.sm.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `540px` and wider   |
| `opts.positionMap.md.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `860px` and wider    |
| `opts.positionMap.md.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `860px` and wider   |
| `opts.positionMap.lg.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1084px` and wider   |
| `opts.positionMap.lg.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1084px` and wider  |
| `opts.positionMap.xl.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1400px` and wider   |
| `opts.positionMap.xl.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1400px` and wider  |

\* Again, this is the fallback style. If one isn't defined, the Positioner instance will instead remove inline position styles (`top`, `left`, `right`, and `bottom`).

### Events

Some custom events are fired when an instance is changed in some way to give a hook to attach callback. Both of the events listed below bubble, meaning they can be listened for on an ancestor of the base element as well as the element itself:

| Event name          | Event target      | Description                                                                   |
|---------------------|-------------------|-------------------------------------------------------------------------------|
| `onUpdate`          | _instance_.`el`   | Dispatches when the instance is updated via a call to _instance_.`update()`   |
| `onRemove`          | _instance_.`el`   | Dispatches when the instance is removed via a call to _instance_.`remove()`   |

### Static methods

These methods are available on the class itself, by default at `window.mwf.Positioner`

#### getInstances()

This method returns an array of all instantiated Positioner instances.

#### setPosition(node, xPos, yPos, unit)

This method sets the `top` and `left` style properties of a DOM Node as an inline style.

| Parameter   | Type                    | Required    | Default     | Description                                     |
|-------------|-------------------------|-------------|-------------|-------------------------------------------------|
| `node`      | `Node`                  | Yes         | `null`      | The Node whose styles are getting set           |
| `xPos`      | `Number` \| `String`    | Yes         | `0`         | The value for the `left` property               |
| `yPos`      | `Number` \| `String`    | Yes         | `0`         | The value for the `top` property                |
| `unit`      | `String`                | Yes         | `""`        | The units for the `top` and `left` properties   |

As a convenience, the method will return the Node passed to it.

| Returns         | Description                               |
|-----------------|-------------------------------------------|
| `Node`          | The DOM node modified by this function    |

#### clearInlinePosition(node)

This method unsets any inline `top`, `left`, `bottom`, and/or `right` styles.

| Parameter   | Type                    | Required    | Default     | Description                                     |
|-------------|-------------------------|-------------|-------------|-------------------------------------------------|
| `node`      | `Node`                  | Yes         | `null`      | The Node whose styles are getting unset         |

As a convenience, the method will return the Node passed to it.

| Returns         | Description                               |
|-----------------|-------------------------------------------|
| `Node`          | The DOM node modified by this function    |

### Instance methods

These methods are available on each individual instance of Positioner.
#### update(opts)

The update function works very similarly to the constructor, except the `el` property of the instance cannot be updated (to do that, `remove()` the instance and create a new one). This function can redefine the position of an element taking into account viewport breakpoints. Note that is does merge with existing position settings, so it's possible to just define, for example, styles for the `sm` viewport without affected previously-define styles for other viewports.

Arguments are passed in as an options object with a structure like this:

```js
myPositioner.update({
  positionMap: {
    sm: {
      top: 20,
      left: 20
    }
  }
});
```

The full list of available options is summarized in the table below:

| Option                          | Value             | Required          | Description                                                                   |
|---------------------------------|-------------------|-------------------|-------------------------------------------------------------------------------|
| `opts.positionMap.default.top`  | `Int` or `Float`  | Recommended*      | Sets the default `top` style property in `%` units                            |
| `opts.positionMap.default.left` | `Int` or `Float`  | Recommended*      | Sets the default `left` style property in `%` units                           |
| `opts.positionMap.sm.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `540px` and wider    |
| `opts.positionMap.sm.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `540px` and wider   |
| `opts.positionMap.md.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `860px` and wider    |
| `opts.positionMap.md.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `860px` and wider   |
| `opts.positionMap.lg.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1084px` and wider   |
| `opts.positionMap.lg.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1084px` and wider  |
| `opts.positionMap.xl.top`       | `Int` or `Float`  | No                | Sets the `top` style property in `%` units for viewports `1400px` and wider   |
| `opts.positionMap.xl.left`      | `Int` or `Float`  | No                | Sets the `left` style property in `%` units for viewports `1400px` and wider  |

\* Again, this is the fallback style. If one isn't defined, the Positioner instance will instead remove inline position styles (`top`, `left`, `right`, and `bottom`).

When this function is called, even with an empty argument, it will dispatch the `onUpdate` event.

#### remove()

This function will tear down the instance of the Positioner class, removing event listeners and the instance itself. It will not remove the DOM Node it is attached to. Also, remember that removing the DOM Node and instance of Positioner is attached to will not remove that instance automatically. Instead, the `remove()` function must be called.

When this function is called, it will dispatch the `onRemove` event.

### Instance properties

This table summarizes the properties that can be found directly on an instance of Positioner.

| Name                    | Type        | Description                                                                                                                       |
|-------------------------|-------------|-----------------------------------------------------------------------------------------------------------------------------------|
| `el`                    | `Node`      | The base element that is positioned by the instance                                                                               |
| `events`                | `Array`     | An array of event listeners attached by this instance; there should be four, each listening for `change` on a `MediaQueryList`    |
| `positionMap`           | `Object`    | A map of position settings by viewport breakpoint, in the same format as the options supplied the the constructor and `update()`  |
