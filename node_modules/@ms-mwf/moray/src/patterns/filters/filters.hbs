<div class="row">
  <div class="col-12">
    {{!-- Page heading --}}
    {{render '@headings' page-heading~}}
    {{!-- Filters heading --}}
    {{~render '@headings' filters-heading~}}
  </div>
</div>
{{#ifCond row2-start '>' 0 }}
<div class="row no-gutters d-none d-sm-flex">
  {{!-- Tablet & desktop primary filters (row 1) --}}
  {{#each ../filters}}
    {{#ifCond @index '<' ../../row2-start}}
      {{setProp ../dropdown 'classes' 'w-100 my-2 col-3 col-md-2 mr-2'}}
      {{setProp ../dropdown.toggle 'style' 'outline'}}
      {{setProp ../dropdown.toggle 'color' 'secondary'}}
      {{#each ../dropdown.menu.template.data.filter}}
        {{#if radio-group}}
          {{setProp radio-group.legend 'classes' 'd-none'}}
        {{/if}}
      {{/each}}
      {{render '@dropdown' ../this.dropdown merge=true}}
    {{/ifCond}}
  {{/each}}
</div>
{{/ifCond}}
<div class="row">
  <div class="col-12">
    {{!-- Tablet & desktop secondary filters, (row 2) --}}
    <div class="d-none d-sm-inline-flex">
      {{~#each filters~}}
        {{~#ifCond @index '>=' ../row2-start~}}
          {{~#each ../dropdown.menu.template.data.filter~}}
            {{~#if radio-group~}}
              {{~setProp radio-group.legend 'classes' 'd-none'~}}
            {{~/if~}}
          {{~/each~}}
          {{~#ifCond @index '<=' (math ../../row2-start '+' 1)~}}
            {{~render '@dropdown' ../../dropdown merge=true~}}
          {{~/ifCond~}}
          {{~#ifCond @index '===' (math ../../row2-start '+' 2)~}}
            {{~#unless (contains ../../dropdown.classes 'd-none d-md-inline-flex')~}}
              {{~setProp ../../dropdown 'classes' (math ../../dropdown.classes '+' ' d-none d-md-inline-flex')~}}
            {{~/unless~}}
            {{~render '@dropdown' ../../dropdown merge=true~}}
          {{~/ifCond~}}
          {{~#ifCond @index '===' (math ../../row2-start '+' 3)~}}
            {{~#unless (contains ../../dropdown.classes 'd-none d-lg-inline-flex')}}
              {{~setProp ../../dropdown 'classes' (math ../../dropdown.classes '+' ' d-none d-lg-inline-flex')~}}
            {{~/unless~}}
            {{~render '@dropdown' ../../dropdown merge=true~}}
          {{~/ifCond~}}
          {{~#ifCond  @index '===' (math ../../row2-start '+' 4)~}}
            {{~#unless (contains ../../dropdown.classes 'd-none d-xl-inline-flex')~}}
              {{~setProp ../../dropdown 'classes' (math ../../dropdown.classes '+' ' d-none d-xl-inline-flex')~}}
            {{~/unless~}}
            {{~render '@dropdown' ../../dropdown merge=true~}}
          {{~/ifCond~}}
        {{~/ifCond~}}
      {{~/each~}}
      {{#ifCond filters.length '>'  (math row2-start '+' 4)}}
        {{#>@dropdown ../more-filters}}
          {{#*inline "menu-partial"}}
            <form data-mount="validation" novalidate>
              {{#each ../../filters}}
                {{#ifCond @index '>' (math ../../../row2-start '+' 1)}}
                  <div {{#ifCond @index '===' (math ../../../../row2-start '+' 2)}}class="d-md-none"{{/ifCond}}{{#ifCond @index '===' (math ../../../../row2-start '+' 3)}}class="d-lg-none"{{/ifCond}}{{#ifCond @index '===' (math ../../../../row2-start '+' 4)}}class="d-xl-none"{{/ifCond}}>
                    {{#each ../dropdown.menu.template.data.filter}}
                      {{#if radio-group}}
                        {{setProp radio-group.legend 'classes' 'text-nowrap font-weight-semibold'}}
                        {{setProp radio-group 'attributes' null}}
                      {{/if}}
                    {{/each}}
                    {{> '@filters--form' filter=../dropdown.menu.template.data.filter}}
                  </div>
                {{/ifCond}}
              {{/each}}
              {{> '@button' color="primary" classes="mt-g float-right" attributes=(object type="submit") text="View results"}}
            </form>
          {{/inline}}
        {{/@dropdown}}
      {{/ifCond}}
    </div>
    {{!-- Mobile filters modal trigger --}}
    <div class="d-inline-block d-sm-none mr-g my-2">
      {{render '@button' all-filters.button}}
    </div>
    {{!-- Sort by --}}
    <div class="float-right form-inline">
      {{render '@select' sort}}
    </div>
  </div>
</div>
{{!-- Applied filter "chips" --}}
<div class="row">
  <div class="col-12 mb-3">
    {{render '@filters--applied-filters' applied-filters}}
  </div>
</div>
<div class="row">
  {{!-- Results heading --}}
  <div class="col-12 mt-g">
    {{render '@headings' results-heading}}
  </div>
  {{!-- Results --}}
  <div class="col-12 mt-g">
    <p class="p-5 bg-neutral-100 text-center">{Results}</p>
  </div>

  {{!-- Filters footer --}}
  <div class="col-12">
    {{> '@divider' classes="border-neutral-200 my-4"}}
    {{#if pagination}}
      {{render '@pagination' pagination}}
    {{/if}}
    <div class="float-md-right form-inline">
      {{render '@select' items-shown}}
    </div>
  </div>
</div>

{{!-- Mobile filters modal --}}
{{#> @modal all-filters.modal}}
  {{#*inline 'body-partial'}}
    {{!-- Accordion --}}
    {{setProp ../mobile-accordion 'collapses' (array)}}
    {{#each ../filters}}
      {{setVar 'button-wrapper-id' (slug (math dropdown.toggle.text '+' ' mobile collapse'))}}
      {{setVar 'button-wrapper' (object html-tag='h3' attributes=(object id=(getVar 'button-wrapper-id')))}}
      {{#ifCond @index '===' 0}}{{setProp (getVar 'button-wrapper') 'classes' 'border-0'}}{{/ifCond}}
      {{setVar 'button' (object text=dropdown.toggle.text attributes=(object type='button'))}}
      {{#each dropdown.menu.template.data.filter}}
        {{#if radio-group}}
          {{setProp radio-group.legend 'classes' 'd-none'}}
        {{/if}}
      {{/each}}
      {{setVar 'template' (object name='filters--form' data=(object filter=dropdown.menu.template.data.filter))}}
      {{push ../../mobile-accordion.collapses (object button-wrapper=(getVar 'button-wrapper') button=(getVar 'button') template=(getVar 'template') auto-expand=true)}}
    {{/each}}
    {{render '@accordion' ../mobile-accordion}}
  {{/inline}}
  {{#*inline 'footer-partial'}}
    {{> '@action-trigger' id=null classes="mr-4" attributes=(object type="button" data-dismiss="modal") text="Cancel"}}
    {{> '@button' id=null color="primary" attributes=(object type="submit") text="View results"}}
  {{/inline}}
{{/@modal}}
